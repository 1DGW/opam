#!/bin/sh
#
# Script run on the machine serving via HTTP a git checkout

notify_and_die() {
# TODO: send an email 
exit 1
}

# Check repos are fine. FIXME: this should be done by the git server
for repo in */version; do
	cd `dirname $repo`
	opam admin check || notify_and_die $repo
	cd ..
done	

# Refresh repo indexes and download archives
for repo in */version; do
	cd `dirname $repo`
	opam admin make
	cd ..
done	
